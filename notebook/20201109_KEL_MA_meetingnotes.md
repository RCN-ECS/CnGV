# 20201109 Meeting notes

* Make the manuscript as complete as possible through Results section, as if we were submitting for peer review
    ~~**MA:** Get it up to snuff so we can see any possible holes in logic.~~

* Check that all approaches for raw data vs. means data are as parallel as possible 
  * Standardization by group means vs. all phenotypic means - what we had talked about back in August vs. in manuscript
      
      ~~**MA:** Yes, standardized by group means~~
      
  * Hypothesis test as delta-GxE=0 (raw data?) vs. delta-GxE = G+E (means data?)
    * At one point I remember digging into the weird null distribution for GxE being created by the permutation: https://github.com/RCN-ECS/CnGV/blob/master/notebook/20200616_KEL_ExploreMeansPermutation.R 
    * Review this post together with Molly
    
    ~~**MA:** *Fix this in the raw data, and then run a single replicate to see if this solves discrepancy in p-values.*~~
    
    ~~**MA:** *Start with single dataset. Look at null distributions for raw and means generated by functions. If they are different that might be important indicator. If they are different, we might be missing something else. Find scenario in p-value that has non-significant raw EMM p-value but significant ANOVA p-value. Make sure it "should" be significant so its not just some quirk. Save this dataset so we can use it to develop and test code. ~~
    
    ~~**MA:** *Instead of length of CI - plot lower CI threshold vs lower confidence interval for means and raw then upper vs. upper in another plot. But its more the pvalues that show the problem so hopefully its the null hypothesis and not the way we are estimating error*~~
  
* Confusion matrix presentation - things to discuss and decide
  * While the "overall" confusion matrices are useful for us, I am hesitant to present them in the main text because the true positive / 
  false negative rates depend on the study design and magnitude of the CovGE
 
~~**MA:** *Want to include both perm and bootstrap for Cov because high false positives is unsettling. Under x design you will have high false negatives with permutation, but high false positives with bootstrap. Need to dig in to find which designs have more false positives or false negatives. For example - if most of false postiives come from small sample size designs, it qualifies it a bit. We could discuss it in those terms. Need to say under these designs, you will have bad outcomes. Under these other designs, you will have better outcomes.*~~
 
 ~~**MA:** *Want to put out an "IDEAL" analysis. For example, look at 128 total samples situations and recommend these designs along with false positive and false negative rates for those designs. High power = >80% power.* *For these specific designs, you can have high false negatives and low false positives... etc. 128 is minimum design for power)*~~

~~**MA:** *Weird power for paired common garden might just be because Im not sampling full range. So I can set systematic clustering to get full range of CovGE and GxE. Check for # of sims to see if I need to sample more from fuller range* ~~
 
    * For example, Fig 4 could be limited to all studies with 128 total sample size or something like that
  * Determine what designs false positives and false negatives are coming from
  * Compare ANOVA confusion matrix to our GxE approach
  * Confusion matrix rates are not consistent across Recip. Trans vs. Paired common garden

* Make a full list of all other things that we need to check and discuss - or not passing sanity checks
  * Write out our equations for the population parameter calculation vs. the sample estimates - especially for Cov-GE.
 
 ~~**MA:** *Ok. So we actually want to calculate Covariance differently for actual vs. estimated values. ACTUAL is our population sample, so we need to standardize by max of NO ERROR variance, and we want to make sure cov is NOT doing n-1 in denominator). This is important for correctly measuring error rates. Both equations are listed in the CNGV ms*. 
  *Play around with this with my targeted play dataset. Make sure its not gonna change my estimates by too much*
  *Make sure that my ACTUAL gxe estimates are being calculated with ACTUAL population means (no error)*~~
  
  
  * Explain the clustering approach for paired common garden sims more clearly
  * Make an outline for the discussion with Geoff
  
  ~~**MA:** *Clean up draft, send to Geoff with emphasis to look at discussion.
  **MA:** *He knows the literature - may be able to broaden it out to get at full implications of having a quantitative measure that the field has never had before. Section on TECHNICAL details, assumptions that go into it (few, because of Permutations), APPLICATIONS, IMPLICATIONS for evolutionary biology. We need ideas for how to make this broadly informative.*~~
   
  * Make sure to have 1000 sims of CovGE = 0 for FPRs
  * Make sure to have 1000 sims of GxE = 0 for FPRs
  * Paired common garden why actual cov GE not covering large values?
  
 ~~**MA:** *Think about targeting sampling designs better. We want at least 1000 of above scenarios, but we also can think more about what combinations will target the parameter space - tiered structure. Like a shotgun of the whole space needs to get to edges (and mostly at zero) and middle slices. (but if fpr is derived mostly from 2x2 sampling and we take that out, maybe it could go way down). Need to really make sure we're sampling properly - what sufficient number would be to make that presentation.*~~
 
 ~~**MA:** *Remake figure 5 - false negatives RATE and false positive RATE into a heat map. Make it with current data but keep sample sizes in each cell. THen we can figure out how to hone in sampling to better figure out where these fpr and fnrs are coming from. (Need to code this for each category but thats easy)*~~
  
  ~~**MA** *Make ANOVA confusion matrix for GxE just as a sanity check*~~
  
  ~~**MA** *With sample dataset that I am going to exemplify in pics, use same one for example code so that people see exactly where "I" came from and does.*~~

* List of questions for https://github.com/RCN-ECS/CnGV/blob/master/notebook/20201016_MA_FullSimResults.md
  * https://github.com/RCN-ECS/CnGV/blob/master/notebook/20201016_MA_FullSimResults.md#confusion-matrix Error rates for full reciprocal transplant and common garden not matching
  * https://github.com/RCN-ECS/CnGV/blob/master/notebook/20201016_MA_FullSimResults.md#parameter-coverage Paired common garden does not appear to be covering large values of CovGE. What are the actual sample sizes for each cell in this figure used to calculate the power from: https://github.com/RCN-ECS/CnGV/blob/master/notebook/20201016_MA_FullSimResults.md#figure-5
    * Also in this figure, within a panel, the power for a design should increase with sample size. However, it's not always consistently the case, which means we have a mistake or some kind of sampling error due to a small number of simulatiosn in that cell.
  * I don't understand this graph https://github.com/RCN-ECS/CnGV/blob/master/results/Sim_10.30.2020/11.1.Cov_RawVsMeans_Env2.png
  * https://github.com/RCN-ECS/CnGV/blob/master/notebook/20201016_MA_FullSimResults.md#gxe-permutation-p-values-vs-anova-p-values I'm confused about the upsidedown "L"-shaped pattern here, and why the patterns in the P-values are not consistent with the raw data vs. group means approaches.
 
  
* Make a new notebook post so that we have the results to compare to last post


# 20201110 Meeting notes KEL

## we talked about manuscript writing is good idea
 * manuscript could be good without GxE, Molly definitely wants it in there


## GxE issue
* permutation approach is different for means data vs. raw data
* the GxE hypothesis test that we have for the means data is specifically for the case when means and SE are provided
* it doesn't appear that we have a function to create the null distribution for raw data
start with one dataset - look at the null distributions for GxE hypothesis test that you're using
choose a dataset that has a significant ANOVA P-value, but the the P-values are reall different for means vs. raw data - make sure it has a decent total sample size * what does this show? discuss check with Katie
* use that dataset to develop and test code
* then run a test set to see if solves the problem
* if necessary, rerun sims

## Confusion matrices
* Come up with a way to present it for specific designs that we recommend
* Do we have enough sims to estimate false positives? Typical sim studies recommend 1000
* Molly thinks this should be a representation of random sampling - we discussed how to structure it so that
* Start with Figure 5, remake with false positive and false negative rates. Specify number of sims in each cell. Then we can talk about how we want to "hone in" if we low samples for the false positive rates.
* Are the 2x2 driving the high FPR?
* Discussed some of the differences in the confusion matrices between the reciprocal transplant vs. common garden data, is it different in the way the parameter space is sampled or something else about the design?
* Discussed benefit of comparing ANOVA confusion matrix to our GxE approach, in terms of convincing reviewers
* Let's figure out how we're going to present it, then figure out what sims we would need to make that presentation, then just run those sims.

## population parameter calculation vs. the sample estimates
* Population parameter - sampled everything - mean is known without error
* Sample esimate - you subtract 1 in the denominator because you lose a df when you estimate the mean from the data
* we went through equations in manuscript - talked about checking it before fixing the code

* Pop: “Actual” True value: CovGE = CovGE=1(i=1ngenj=1nenv)(I)( i=1ngenj=1nenv(i-)(j-)Imax(2i, 2j))
* Mui and muj and mu are true means known without error
* Sigma2_ui and Sigma2_uj are true variance in the true group means (known without error)

* Sample Estimate from the data: CovGE =CovGE=1(i=1ngenj=1nenv)(I)-1( i=1ngenj=1nenv(yi-y)(yj-y)Imax(s2yi, s2yj))
* Ybar-i and ybar-j are sample means estimated from the sample
* S2_yi and s2_yj are sample variances in the group means estimated from the data
* The minus one in the denominator is lost because the group mean is calculated from the data and not known without error

* Molly thinks GxE is based on true means, but will double check

## Why not fully sampling common garden?
* Molly can play around with clustering
* thinks it's because she did a shotgun
* are some of the designs that the paired common gardent looks better than the reciprocal transplant may be by chance, b/c low sample size
* when remake the power heatmaps, asssess the number of sims in each cell and use that to assess if we need to sample more

## other 
* put Geoff on a draft of the manuscript and get ideas for beefing up discussion
* supplement with an example of a dataset and calculation - could use this to show how the Indicator Variable "I" is incorporated into the calculation - address Sara's comments on manuscript


