# Simulation Diagnostic Explorations: 

The results of my simulations are giving me some strange values. GxE estimates near zero are significant (and they shouldn't be), while other GxE values are high, but not significant (and they should be). Additionally, there is some weirdness with the covariance estimates. 

I chose the following 3 scenarios to look further at the null distributions as a way of figuring out these weird p-value situations. 

Index | delta_env | delta_gen | sample_size | n_pop | std_dev | interaction | reason 
---|---|---|---|---|---|---|---
1 | 0.0| -1|5|5|0.1|0| The GxE is near zero yet p <0.01. Also, the true_cov is -.21 with p = 0.27 but is weird because index = 2 is higher true_cov but lower pvalue
2 | 0.5| 0|5|5|0.1|0| The cov estimate is higher than index=1 but the pvalue is lower
3 | 1| -1|5|5|0.1|1.5|This one has a high GxE and is significant - this one is behaving the way I would expect for GxE. 


Here are the histograms of the null distributions generated by the permutations I ran with 100 bootstraps: 
Columns = index

### 3.26.2020 Adventures in Idiocy: 
I was plotting the WRONG DAMN THING. Ugh. Sometimes, my brain...  I swear to God. ANYWAY. Here are some correct plots: 

But because you asked - first here is my code for how I am calculating p-values: 
```{sig code}

# Covariance P-value
    ptemp = (rank(c(cov_est,perm_df[,1]))[1])/(n_boot+1) # perm_df[1] = vector of covariance estimates generated from new distribution at length = n_boot
    cov_pvalue = NULL
    if(ptemp < 0.5){cov_pvalue = ptemp}else{cov_pvalue = (1-ptemp)} # 2-tailed
    
    # GxE P-value
    ptemp1 = (rank(c(GxE_emm,perm_df[,2]))[1])/(n_boot+1) # perm_df[1] = vector of GxE estimates generated from new distribution at length = n_boot
    GxE_pvalue = NULL
    if(ptemp1 < 0.5){GxE_pvalue = ptemp1}else{GxE_pvalue = (1-ptemp1)} # 2-tailed
    
```
Ok. The null distribution, estimates, and pvalues for Covariance look to be okay: (black vertical line signifies Covariance estimate, red line = true covariance)
![image](https://github.com/RCN-ECS/CnGV/blob/master/results/Sim_03152020/correctNullCov.png)

Onto GxE. I am getting significant Pvalues when GxE is near zero because the null does not center around zero. Now. Why might that be? DUH. Because I'm running a 2-tailed test when I only want a 1-tailed test. Jesus H. Christ. 
![image](https://github.com/RCN-ECS/CnGV/blob/master/results/Sim_03152020/correctNull_GxE.png)

To make the p-value code one tailed, I now use this code to estimate GxE significance: 
```{r}
# GxE P-value
    ptemp1 = (rank(c(GxE_emm,perm_df[,2]))[1])/(n_boot+1) 
    GxE_pvalue = 1-ptemp1 # Right-tailed
```
After fixing the GxE p-value code, I ran a 16 parameter combos (50 bootstraps for speed) just to make sure its all going the way its supposed to. And from the looks of these panels, it is. Phew. Puzzle solved. 
![image](https://github.com/RCN-ECS/CnGV/blob/master/results/Sim_03152020/GxE_puzzlesolved.png)



